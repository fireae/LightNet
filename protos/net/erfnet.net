#define DTYPE TL_FLOAT

#define conv(in_name, out_name, in_c, out_c,                            \
             _group, _size, _stride, _padding, _dilation)               \
    create(| dst=out_name##_weight |                                    \
           dtype=DTYPE, dims=[out_c, ${eval in_c/_group}, _size, _size],\
           ran=[-10, 10], data=[0], from_file=false);                   \
    create(| dst=out_name##_bias | dtype=DTYPE, dims=[out_c],           \
           ran=[0, 0], data=[0], from_file=false);                      \
    conv2d(src=in_name, weight=out_name##_weight, bias=out_name##_bias |\
           dst=out_name | group=_group, size=[_size, _size],            \
           stride=[_stride, _stride],                                   \
           padding=[_padding, _padding, _padding, _padding],            \
           autopad="SAME_UPPER",                                        \
           dilation=[_dilation, _dilation])

#define downsampler(in, out, in_c, out_c) \
    maxpool2d(src=in | dst=out##_pool | size=[2, 2], stride=[2, 2], padding=[0, 0, 0, 0], autopad="SAME_UPPER");\
    conv(in, out##_conv, in_c, ${eval out_c-in_c}, 1, 3, 2, 0, 1);\
    concat(src1=out##_pool, src2=out##_conv | dst=out##_concat | axis=1);\
    /* out##_out##_ is the name pattern */
    batchnorm(src=out##_concat, scale=out##_out##_bn_gamma, \
              offset=out##_out##_bn_beta, mean=out##_out##_bn_moving_mean, \
              var=out##_out##_bn_moving_variance | dst=out##_bn | epsilon=1e-5);\
    relu(src=out##_bn | dst=out);

#define res_nonbt1d()